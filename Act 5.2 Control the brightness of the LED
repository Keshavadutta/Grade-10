#include <WiFi.h>
#include "Adafruit_MQTT.h"
#include "Adafruit_MQTT_Client.h"

#define SSID      "     "// WIFI SSID
#define PASS      "        "//WIFI PASSWORD
#define USERNAME  "      "//adafruit username
#define AIO_KEY   "    "//adafruit key

WiFiClient client;
Adafruit_MQTT_Client mqtt(&client, "io.adafruit.com", 1883, USERNAME, AIO_KEY);
Adafruit_MQTT_Subscribe brightness(&mqtt, USERNAME "/feeds/brightness");

const int LED = 12;

void setup() {
  Serial.begin(115200);
  ledcSetup(0, 5000, 8);
  ledcAttachPin(LED, 0);

  WiFi.begin(SSID, PASS);
  while (WiFi.status() != WL_CONNECTED) delay(500);

  mqtt.subscribe(&brightness);
}

void loop() {
  if (!mqtt.connected()) while (mqtt.connect() != 0) delay(2000);

  mqtt.processPackets(10);
  mqtt.ping();

  auto sub = mqtt.readSubscription(10);
  if (sub == &brightness) ledcWrite(0, constrain(String((char*)brightness.lastread).toInt(), 0, 255));
}


